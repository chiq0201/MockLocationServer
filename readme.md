

# 概要

android デバイスに仮の位置情報をセットするアプリケーションです。

https://developer.android.com/reference/android/location/LocationManager#addTestProvider(java.lang.String,%20boolean,%20boolean,%20boolean,%20boolean,%20boolean,%20boolean,%20boolean,%20int,%20int)


# 動作説明

フォアグラウンドサービス (以降、サービス) を使用し、常駐します。

サービスを開始した際に、web サーバーを起動します。

web サーバーに http リクエストを送信することで、仮の位置情報を設定します。

リクエストされた位置情報がある場合、測位時刻を現在時刻へ変更し、毎秒、仮の位置情報を更新します。

サービスの終了時に仮の位置情報は削除します。以降は、実際の現在位置情報が使用されます。


# web サーバー

8080番ポートを使用します。

## テスト用ウェブページ 

ブラウザで ```ipアドレス:8080``` へアクセスすると、apk が持つ html を表示します。

Google Map が表示され、以下の方法により位置情報を送信することができます。

* Google Map の任意の点をダブルクリックする ... クリックされた場所の位置情報を送信する
* フォームの送信ボタンをクリックする ... フォームに入力された位置情報を送信する
* マーカーをドラッグする ... ドラッグ後の位置情報を送信する


また、マップ右上にあるテキストフィールドに、```{緯度} {経度}```を入力しエンターを押すと、マップの中央を移動します。


### API キーについて
Google Map Platform の認証情報はセットしていません。セットする場合は、以下のようにクエリパラメータ ```key``` にAPIキーを渡してください。

```
ipアドレス:8080/key=?{APIキー}
```


以下、APIキーの制限の例です。
* アプリケーションの制限 ... ```HTTP リファラー``` を選択
* ウェブサイトの制限 ... ```*:8080/``` を追加
* APIの制限 ... ```キーを制限``` を選択し、```Map JavaScript API``` を選択


## APIフォーマット:位置を設定する

curl 等、リクエストを送信することで位置情報を設定します。

**エンドポイント**

```/api/location```

 
**データフォーマット**

以下の値を持つ JSON とする。

|フィールド名|値|説明|
|-|-|-|
|latitude|数値|緯度 (単位:度)|
|longitude|数値|緯度 (単位:度)|
|altitude|数値|高度 (単位:メートル)※省略した場合は 0|
|haccuracy|数値|水平精度 (単位:メートル)※省略した場合は 0|
|repeatedlyUpdate|bool|この位置情報(速度を除く)を毎秒セットする ※省略した場合は false|
|velocity|数値|速度 (単位:メートル/秒) ※省略した場合は 0|


例

```
{
  "latitude": 34.1234,
  "longitude": 134.1234,
  "altitude: 1.0,
  "haccuracy": 2.0
}
```
 

**ステータスコード**

データフォーマットが正しければ、ステータスコード 200 を返す。

データフォーマットが正しくなければ、ステータスコード 400 を返す。


